<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Toolberry</title>
  <link rel="icon" type="image/png" href="favicon.png" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
      background: #fff5f7;
      color: #1a1a1a;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    /* Header */
    header {
      padding: 1.5rem 3rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
      border-bottom: 1px solid #ffd4dc;
      background: white;
      position: sticky;
      top: 0;
      z-index: 100;
    }

    .header-left {
      display: flex;
      align-items: center;
      gap: 2.5rem;
    }

    #site-logo-link {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      text-decoration: none;
      color: #e63946;
      font-size: 1.25rem;
      font-weight: 700;
      letter-spacing: -0.5px;
      transition: opacity 0.2s;
    }

    #site-logo-link:hover {
      opacity: 0.8;
    }

    #site-logo-link img {
      width: 28px;
      height: 28px;
    }

    .header-nav {
      display: flex;
      align-items: center;
      gap: 2rem;
    }

    .nav-link {
      color: #666;
      text-decoration: none;
      font-size: 0.9375rem;
      font-weight: 500;
      transition: color 0.2s;
      cursor: pointer;
    }

    .nav-link:hover {
      color: #e63946;
    }

    /* Tools Dropdown */
    .tools-dropdown {
      position: relative;
    }

    #tools-btn {
      background: #e63946;
      color: white;
      border: none;
      padding: 0.5rem 1.25rem;
      font-size: 0.875rem;
      font-weight: 500;
      cursor: pointer;
      border-radius: 20px;
      transition: all 0.2s;
      letter-spacing: 0.3px;
    }

    #tools-btn:hover {
      background: #d62839;
      transform: translateY(-1px);
    }

    .dropdown-menu {
      position: absolute;
      top: calc(100% + 0.5rem);
      right: 0;
      background: white;
      border: 1px solid #ffd4dc;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(230, 57, 70, 0.15);
      min-width: 200px;
      overflow: hidden;
      opacity: 0;
      transform: translateY(-10px);
      pointer-events: none;
      transition: opacity 0.3s ease, transform 0.3s ease;
    }

    .dropdown-menu.show {
      opacity: 1;
      transform: translateY(0);
      pointer-events: auto;
    }

    .dropdown-item {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      padding: 1rem 1.25rem;
      color: #1a1a1a;
      text-decoration: none;
      transition: all 0.2s;
      cursor: pointer;
      border-bottom: 1px solid #ffd4dc;
    }

    .dropdown-item:last-child {
      border-bottom: none;
    }

    .dropdown-item:hover {
      background: #fff5f7;
      color: #e63946;
    }

    .dropdown-emoji {
      font-size: 1.25rem;
    }

    .dropdown-name {
      font-size: 0.9375rem;
      font-weight: 500;
    }

    /* Main Content */
    main {
      flex: 1;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 2rem;
      position: relative;
      overflow: hidden;
    }

    /* Pages */
    .page {
      display: none;
      width: 100%;
      max-width: 1000px;
      margin: 0 auto;
      opacity: 0;
      transform: translateY(20px);
      transition: opacity 0.4s ease, transform 0.4s ease;
    }

    .page.active {
      display: block;
      animation: fadeInUp 0.4s ease forwards;
    }

    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    /* Home Page */
    .home-page {
      text-align: center;
      max-width: 900px;
      width: 100%;
      margin: 0 auto;
    }

    .home-title {
      font-size: 6.5rem;
      font-weight: 700;
      color: #e63946;
      margin-bottom: 4rem;
      letter-spacing: -3px;
    }

    .tools-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      gap: 1.25rem;
      margin-bottom: 2rem;
    }

    .tool-card {
      background: white;
      border: 1px solid #ffd4dc;
      border-radius: 16px;
      padding: 1.5rem 1rem;
      cursor: pointer;
      transition: all 0.2s;
      text-decoration: none;
      color: inherit;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 0.75rem;
    }

    .tool-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 8px 20px rgba(230, 57, 70, 0.15);
      border-color: #e63946;
    }

    .tool-card-emoji {
      font-size: 2.5rem;
    }

    .tool-card-title {
      font-size: 1rem;
      font-weight: 600;
      color: #1a1a1a;
    }

    .tool-card-desc {
      font-size: 0.8125rem;
      color: #666;
      line-height: 1.4;
    }

    /* Tool Pages */
    .tool-page {
      background: white;
      border: 1px solid #ffd4dc;
      padding: 3rem 2.5rem;
      width: 100%;
      max-width: 600px;
      box-shadow: 0 4px 12px rgba(230, 57, 70, 0.08);
      border-radius: 24px;
      margin: 0 auto;
    }

    /* Content Pages (About, How to use) */
    .content-page {
      background: white;
      border: 1px solid #ffd4dc;
      padding: 3rem 2.5rem;
      width: 100%;
      max-width: 800px;
      box-shadow: 0 4px 12px rgba(230, 57, 70, 0.08);
      border-radius: 24px;
      margin: 0 auto;
    }

    .back-button {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      color: #666;
      text-decoration: none;
      font-size: 0.875rem;
      margin-bottom: 1.5rem;
      transition: color 0.2s;
    }

    .back-button:hover {
      color: #e63946;
    }

    h1 {
      font-size: 1.75rem;
      font-weight: 600;
      margin-bottom: 0.5rem;
      letter-spacing: -0.5px;
      color: #1a1a1a;
    }

    .subtitle {
      font-size: 0.875rem;
      color: #666;
      margin-bottom: 2rem;
    }

    .content-body {
      color: #333;
      line-height: 1.8;
      font-size: 0.9375rem;
    }

    .content-body p {
      margin-bottom: 1rem;
    }

    .content-body h2 {
      font-size: 1.25rem;
      font-weight: 600;
      color: #e63946;
      margin-top: 2rem;
      margin-bottom: 1rem;
    }

    form {
      display: flex;
      flex-direction: column;
      gap: 1.25rem;
    }

    input[type="text"] {
      width: 100%;
      padding: 0.875rem;
      border: 1px solid #ffd4dc;
      font-size: 0.9375rem;
      outline: none;
      background: #fff5f7;
      color: #1a1a1a;
      transition: all 0.2s;
      font-family: inherit;
      border-radius: 12px;
    }

    input[type="text"]:focus {
      background: white;
      border-color: #e63946;
      box-shadow: 0 0 0 3px rgba(230, 57, 70, 0.1);
    }

    input[type="text"]::placeholder {
      color: #999;
    }

    button[type="submit"] {
      width: 100%;
      background: #e63946;
      color: white;
      border: none;
      padding: 0.875rem;
      cursor: pointer;
      font-size: 0.9375rem;
      font-weight: 500;
      transition: all 0.2s;
      letter-spacing: 0.3px;
      font-family: inherit;
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
      position: relative;
    }

    button[type="submit"]:hover {
      background: #d62839;
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(230, 57, 70, 0.2);
    }

    button[type="submit"]:disabled {
      background: #ffb3ba;
      cursor: not-allowed;
      transform: none;
    }

    .loading-spinner {
      width: 16px;
      height: 16px;
      border: 2px solid rgba(255, 255, 255, 0.3);
      border-top-color: white;
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
      display: none;
    }

    button[type="submit"].loading .loading-spinner {
      display: block;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    /* QR Result */
    #qr-result {
      margin-top: 1.5rem;
      padding-top: 1.5rem;
      border-top: 1px solid #ffd4dc;
      text-align: center;
    }

    #qr-result img {
      max-width: 100%;
      height: auto;
      border: 1px solid #ffd4dc;
      border-radius: 12px;
    }

    /* Timer Styles */
    .timer-display {
      text-align: center;
      margin: 2rem 0;
    }

    .timer-time {
      font-size: 4rem;
      font-weight: 700;
      color: #e63946;
      font-family: 'Courier New', monospace;
      margin: 1rem 0;
      letter-spacing: 0.1em;
    }

    .timer-inputs {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 1rem;
      margin-bottom: 1.5rem;
    }

    .timer-input-group {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }

    .timer-input-label {
      font-size: 0.875rem;
      color: #666;
      font-weight: 500;
    }

    .timer-input {
      width: 100%;
      padding: 0.75rem;
      border: 1px solid #ffd4dc;
      font-size: 1.5rem;
      text-align: center;
      outline: none;
      background: #fff5f7;
      color: #1a1a1a;
      transition: all 0.2s;
      font-family: 'Courier New', monospace;
      border-radius: 12px;
      font-weight: 600;
    }

    .timer-input:focus {
      background: white;
      border-color: #e63946;
      box-shadow: 0 0 0 3px rgba(230, 57, 70, 0.1);
    }

    .timer-buttons {
      display: flex;
      gap: 1rem;
    }

    .timer-btn {
      flex: 1;
      background: #e63946;
      color: white;
      border: none;
      padding: 0.875rem;
      cursor: pointer;
      font-size: 0.9375rem;
      font-weight: 500;
      transition: all 0.2s;
      letter-spacing: 0.3px;
      font-family: inherit;
      border-radius: 12px;
    }

    .timer-btn:hover {
      background: #d62839;
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(230, 57, 70, 0.2);
    }

    .timer-btn:disabled {
      background: #ffb3ba;
      cursor: not-allowed;
      transform: none;
    }

    .timer-btn.secondary {
      background: #666;
    }

    .timer-btn.secondary:hover {
      background: #555;
    }

    .timer-status {
      text-align: center;
      margin-top: 1rem;
      font-size: 0.875rem;
      color: #666;
      min-height: 1.5rem;
    }

    .timer-status.active {
      color: #e63946;
      font-weight: 600;
    }

    /* Color Picker Styles */
    .color-upload {
      border: 2px dashed #ffd4dc;
      border-radius: 16px;
      padding: 2rem;
      text-align: center;
      background: #fff5f7;
      cursor: pointer;
      transition: all 0.2s;
      margin-bottom: 1.5rem;
    }

    .color-upload:hover {
      border-color: #e63946;
      background: white;
    }

    .color-upload.has-image {
      border-style: solid;
      padding: 0;
      background: white;
    }

    .upload-label {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 0.75rem;
      cursor: pointer;
      padding: 2rem;
    }

    .upload-icon {
      font-size: 3rem;
    }

    .upload-text {
      font-size: 0.9375rem;
      color: #666;
    }

    #color-file-input {
      display: none;
    }

    .color-canvas-wrapper {
      position: relative;
      display: inline-block;
      max-width: 100%;
    }

    #color-canvas {
      max-width: 100%;
      height: auto;
      cursor: crosshair;
      border-radius: 12px;
      display: block;
    }

    .color-info {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 1rem;
      margin-top: 1.5rem;
    }

    .color-info-item {
      background: #fff5f7;
      border: 1px solid #ffd4dc;
      border-radius: 12px;
      padding: 1.25rem;
      text-align: center;
    }

    .color-info-label {
      font-size: 0.75rem;
      color: #666;
      margin-bottom: 0.5rem;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .color-info-value {
      font-size: 1.25rem;
      font-weight: 600;
      color: #1a1a1a;
      font-family: 'Courier New', monospace;
    }

    .color-preview {
      width: 100%;
      height: 80px;
      border-radius: 8px;
      border: 1px solid #ffd4dc;
      margin-bottom: 0.5rem;
    }

    .color-actions {
      display: flex;
      gap: 0.75rem;
      margin-top: 1.5rem;
    }

    .color-btn {
      flex: 1;
      background: #e63946;
      color: white;
      border: none;
      padding: 0.75rem;
      cursor: pointer;
      font-size: 0.875rem;
      font-weight: 500;
      transition: all 0.2s;
      letter-spacing: 0.3px;
      font-family: inherit;
      border-radius: 12px;
    }

    .color-btn:hover {
      background: #d62839;
      transform: translateY(-1px);
    }

    .color-btn.secondary {
      background: #666;
    }

    .color-btn.secondary:hover {
      background: #555;
    }

    .color-hint {
      text-align: center;
      font-size: 0.875rem;
      color: #999;
      margin-top: 1rem;
    }

    /* Image Resize Styles */
    .resize-upload {
      border: 2px dashed #ffd4dc;
      border-radius: 16px;
      padding: 2rem;
      text-align: center;
      background: #fff5f7;
      cursor: pointer;
      transition: all 0.2s;
      margin-bottom: 1.5rem;
    }

    .resize-upload:hover {
      border-color: #e63946;
      background: white;
    }

    #resize-file-input {
      display: none;
    }

    .resize-controls {
      display: flex;
      flex-direction: column;
      gap: 1rem;
      margin-bottom: 1.5rem;
    }

    .resize-input-group {
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    .resize-input-group label {
      min-width: 80px;
      font-size: 0.875rem;
      color: #666;
      font-weight: 500;
    }

    .resize-input-group input {
      flex: 1;
      padding: 0.75rem;
      border: 1px solid #ffd4dc;
      font-size: 0.9375rem;
      outline: none;
      background: #fff5f7;
      color: #1a1a1a;
      transition: all 0.2s;
      font-family: inherit;
      border-radius: 12px;
    }

    .resize-input-group input:focus {
      background: white;
      border-color: #e63946;
      box-shadow: 0 0 0 3px rgba(230, 57, 70, 0.1);
    }

    .resize-preview {
      text-align: center;
      margin: 1.5rem 0;
    }

    .resize-preview img {
      max-width: 100%;
      height: auto;
      border-radius: 12px;
      border: 1px solid #ffd4dc;
    }

    .resize-info {
      text-align: center;
      font-size: 0.875rem;
      color: #666;
      margin-bottom: 1rem;
    }

    .resize-buttons {
      display: flex;
      gap: 0.75rem;
    }

    .resize-btn {
      flex: 1;
      background: #e63946;
      color: white;
      border: none;
      padding: 0.875rem;
      cursor: pointer;
      font-size: 0.9375rem;
      font-weight: 500;
      transition: all 0.2s;
      letter-spacing: 0.3px;
      font-family: inherit;
      border-radius: 12px;
    }

    .resize-btn:hover {
      background: #d62839;
      transform: translateY(-1px);
    }

    .resize-btn:disabled {
      background: #ffb3ba;
      cursor: not-allowed;
      transform: none;
    }

    .resize-btn.secondary {
      background: #666;
    }

    .resize-btn.secondary:hover {
      background: #555;
    }

    /* Error Modal */
    .error-modal {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.5);
      justify-content: center;
      align-items: center;
      z-index: 2000;
      opacity: 0;
      transition: opacity 0.3s ease;
    }

    .error-modal.show {
      display: flex;
      opacity: 1;
    }

    .error-modal-content {
      background: white;
      padding: 2.5rem;
      width: 90%;
      max-width: 400px;
      border: 1px solid #ffd4dc;
      box-shadow: 0 8px 24px rgba(230, 57, 70, 0.2);
      border-radius: 20px;
      text-align: center;
      animation: errorSlideIn 0.3s ease;
    }

    @keyframes errorSlideIn {
      from {
        transform: scale(0.9);
        opacity: 0;
      }
      to {
        transform: scale(1);
        opacity: 1;
      }
    }

    .error-icon {
      font-size: 3rem;
      margin-bottom: 1rem;
    }

    .error-title {
      font-size: 1.25rem;
      font-weight: 600;
      color: #e63946;
      margin-bottom: 0.75rem;
    }

    .error-message {
      font-size: 0.9375rem;
      color: #666;
      line-height: 1.6;
      margin-bottom: 1.5rem;
    }

    .error-btn {
      background: #e63946;
      color: white;
      border: none;
      padding: 0.75rem 2rem;
      font-size: 0.9375rem;
      font-weight: 500;
      cursor: pointer;
      border-radius: 12px;
      transition: all 0.2s;
      letter-spacing: 0.3px;
    }

    .error-btn:hover {
      background: #d62839;
      transform: translateY(-1px);
    }

    @media (max-width: 768px) {
      header {
        padding: 1rem 1.5rem;
        flex-wrap: wrap;
        gap: 1rem;
      }

      .header-left {
        gap: 1rem;
        flex: 1;
        min-width: 0;
      }

      #site-logo-link {
        font-size: 1.125rem;
      }

      #site-logo-link img {
        width: 24px;
        height: 24px;
      }

      .header-nav {
        gap: 0.75rem;
      }

      .nav-link {
        font-size: 0.8125rem;
      }

      .tools-dropdown {
        width: 100%;
        order: 3;
      }

      #tools-btn {
        width: 100%;
      }

      .dropdown-menu {
        left: 0;
        right: 0;
        width: 100%;
      }

      .home-title {
        font-size: 3rem;
      }

      .tools-grid {
        grid-template-columns: 1fr;
      }

      .tool-page,
      .content-page {
        padding: 2rem 1.5rem;
      }

      .timer-inputs {
        grid-template-columns: 1fr;
      }

      .timer-time {
        font-size: 2.5rem;
        word-break: break-all;
      }

      .color-info {
        grid-template-columns: 1fr;
      }
    }
  </style>
  <meta name="google-site-verification" content="Pp78s3VdtesQ-8OoBLubzsq1GBs1oAsxTskAecvy_I4" />
</head>
<body>
  <header>
    <div class="header-left">
      <a href="#" id="site-logo-link">
        <img src="logo.png" alt="Toolberry Logo" />
        <span>Toolberry</span>
      </a>
      <nav class="header-nav">
        <a class="nav-link" id="about-link">About</a>
        <a class="nav-link" id="howto-link">How to use</a>
      </nav>
    </div>
    <div class="tools-dropdown">
      <button id="tools-btn">Tools ‚ñº</button>
      <div class="dropdown-menu" id="tools-menu">
        <a class="dropdown-item" data-tool="html">
          <span class="dropdown-emoji">üåê</span>
          <span class="dropdown-name">HTML Downloader</span>
        </a>
        <a class="dropdown-item" data-tool="sb3">
          <span class="dropdown-emoji">üê±</span>
          <span class="dropdown-name">SB3 Downloader</span>
        </a>
        <a class="dropdown-item" data-tool="qr">
          <span class="dropdown-emoji">üì±</span>
          <span class="dropdown-name">QR Maker</span>
        </a>
        <a class="dropdown-item" data-tool="timer">
          <span class="dropdown-emoji">‚è±Ô∏è</span>
          <span class="dropdown-name">Web Timer</span>
        </a>
        <a class="dropdown-item" data-tool="colorpicker">
          <span class="dropdown-emoji">üé®</span>
          <span class="dropdown-name">Color Picker</span>
        </a>
        <a class="dropdown-item" data-tool="resize">
          <span class="dropdown-emoji">üìê</span>
          <span class="dropdown-name">Image Resize</span>
        </a>
        <a class="dropdown-item" id="more-tools-btn" style="border-top: 2px solid #ffd4dc;">
          <span class="dropdown-emoji">üì¶</span>
          <span class="dropdown-name">More Tools</span>
        </a>
      </div>
    </div>
  </header>

  <main>
    <!-- Home Page -->
    <div class="page active" id="home-page">
      <div class="home-page">
        <h1 class="home-title">Toolberry</h1>
        <div class="tools-grid">
          <div class="tool-card" data-tool="html">
            <div class="tool-card-emoji">üåê</div>
            <div class="tool-card-title">HTML Downloader</div>
            <div class="tool-card-desc">Download any webpage as HTML</div>
          </div>
          <div class="tool-card" data-tool="sb3">
            <div class="tool-card-emoji">üê±</div>
            <div class="tool-card-title">SB3 Downloader</div>
            <div class="tool-card-desc">Download Scratch projects</div>
          </div>
          <div class="tool-card" data-tool="qr">
            <div class="tool-card-emoji">üì±</div>
            <div class="tool-card-title">QR Code Maker</div>
            <div class="tool-card-desc">Generate QR codes</div>
          </div>
          <div class="tool-card" data-tool="timer">
            <div class="tool-card-emoji">‚è±Ô∏è</div>
            <div class="tool-card-title">Web Timer</div>
            <div class="tool-card-desc">Simple countdown timer</div>
          </div>
          <div class="tool-card" data-tool="colorpicker">
            <div class="tool-card-emoji">üé®</div>
            <div class="tool-card-title">Color Picker</div>
            <div class="tool-card-desc">Pick colors from images</div>
          </div>
          <div class="tool-card" data-tool="resize">
            <div class="tool-card-emoji">üìê</div>
            <div class="tool-card-title">Image Resize</div>
            <div class="tool-card-desc">Resize images easily</div>
          </div>
          <div class="tool-card" data-tool="imagecrop">
            <div class="tool-card-emoji">‚úÇÔ∏è</div>
            <div class="tool-card-title">Image Crop</div>
            <div class="tool-card-desc">Crop and trim images</div>
          </div>
          <div class="tool-card" data-tool="charcount">
            <div class="tool-card-emoji">üî§</div>
            <div class="tool-card-title">Character Counter</div>
            <div class="tool-card-desc">Count characters and words</div>
          </div>
          <div class="tool-card" data-tool="zipcompress">
            <div class="tool-card-emoji">üóúÔ∏è</div>
            <div class="tool-card-title">ZIP Compress</div>
            <div class="tool-card-desc">Compress files to ZIP</div>
          </div>
          <div class="tool-card" data-tool="imagecompress">
            <div class="tool-card-emoji">üì¶</div>
            <div class="tool-card-title">Image Compress</div>
            <div class="tool-card-desc">Reduce image file size</div>
          </div>
        </div>
      </div>
    </div>

    <!-- About Page -->
    <div class="page" id="about-page">
      <div class="content-page">
        <a href="#" class="back-button">‚Üê Back to Home</a>
        <h1>About</h1>
        <div class="content-body">
          <p>Toolberry is a simple web tool site that you can use for free.</p>

          <h2>Features</h2>
          <p>A web tool site that delivers a free experience to users, combining an easy-to-use UI/UX with lightweight performance.</p>

          <h2>Technology</h2>
          <p>This site was created using AI in part.</p>
        </div>
      </div>
    </div>

    <!-- How to use Page -->
    <div class="page" id="howto-page">
      <div class="content-page">
        <a href="#" class="back-button">‚Üê Back to Home</a>
        <h1>How to use</h1>
        <div class="content-body">
          <p>Select a tool from the home screen or press the Tools button in the header to choose a tool.</p>
        </div>
      </div>
    </div>

    <!-- HTML Downloader -->
    <div class="page" id="html-page">
      <div class="tool-page">
        <a href="#" class="back-button">‚Üê Back to Home</a>
        <h1>HTML Downloader</h1>
        <p class="subtitle">Download any webpage as an HTML file</p>
        <form id="html-form">
          <input type="text" name="url" placeholder="https://example.com" required />
          <button type="submit">
            <span class="loading-spinner"></span>
            <span class="button-text">Download</span>
          </button>
        </form>
      </div>
    </div>

    <!-- SB3 Downloader -->
    <div class="page" id="sb3-page">
      <div class="tool-page">
        <a href="#" class="back-button">‚Üê Back to Home</a>
        <h1>SB3 Downloader</h1>
        <p class="subtitle">Download Scratch projects as .sb3 files</p>
        <form id="sb3-form">
          <input type="text" id="scratch-id" placeholder="Scratch URL or Project ID" required />
          <button type="submit">
            <span class="loading-spinner"></span>
            <span class="button-text">Download</span>
          </button>
        </form>
      </div>
    </div>

    <!-- QR Code Maker -->
    <div class="page" id="qr-page">
      <div class="tool-page">
        <a href="#" class="back-button">‚Üê Back to Home</a>
        <h1>QR Code Maker</h1>
        <p class="subtitle">Generate QR codes for text or URLs</p>
        <form id="qr-form">
          <input type="text" id="qr-text" placeholder="example.com or any text" required />
          <button type="submit">
            <span class="loading-spinner"></span>
            <span class="button-text">Generate</span>
          </button>
        </form>
        <div id="qr-result"></div>
      </div>
    </div>

    <!-- Web Timer -->
    <div class="page" id="timer-page">
      <div class="tool-page">
        <a href="#" class="back-button">‚Üê Back to Home</a>
        <h1>Web Timer</h1>
        <p class="subtitle">Simple countdown timer for any task</p>

        <div class="timer-inputs">
          <div class="timer-input-group">
            <label class="timer-input-label">Hours</label>
            <input type="number" id="timer-hours" class="timer-input" min="0" max="23" value="0" />
          </div>
          <div class="timer-input-group">
            <label class="timer-input-label">Minutes</label>
            <input type="number" id="timer-minutes" class="timer-input" min="0" max="59" value="0" />
          </div>
          <div class="timer-input-group">
            <label class="timer-input-label">Seconds</label>
            <input type="number" id="timer-seconds" class="timer-input" min="0" max="59" value="0" />
          </div>
        </div>

        <div class="timer-display">
          <div class="timer-time" id="timer-display">00:00:00</div>
        </div>

        <div class="timer-buttons">
          <button class="timer-btn" id="timer-start">Start</button>
          <button class="timer-btn secondary" id="timer-reset">Reset</button>
        </div>

        <div class="timer-status" id="timer-status"></div>
      </div>
    </div>

    <!-- Color Picker -->
    <div class="page" id="colorpicker-page">
      <div class="tool-page">
        <a href="#" class="back-button">‚Üê Back to Home</a>
        <h1>Color Picker</h1>
        <p class="subtitle">Pick colors from your images</p>

        <div class="color-upload" id="color-upload-area">
          <label for="color-file-input" class="upload-label">
            <div class="upload-icon">üé®</div>
            <div class="upload-text">Click to upload image or drag & drop</div>
          </label>
          <input type="file" id="color-file-input" accept="image/*" />
        </div>

        <div id="color-canvas-container" style="display: none;">
          <div class="color-canvas-wrapper">
            <canvas id="color-canvas"></canvas>
          </div>

          <p class="color-hint">Click anywhere on the image to pick a color</p>

          <div class="color-info">
            <div class="color-info-item">
              <div class="color-info-label">Color Preview</div>
              <div class="color-preview" id="color-preview"></div>
              <div class="color-info-value" id="color-hex">#000000</div>
            </div>
            <div class="color-info-item">
              <div class="color-info-label">RGB Value</div>
              <div class="color-info-value" id="color-rgb">rgb(0, 0, 0)</div>
            </div>
          </div>

          <div class="color-actions">
            <button class="color-btn" id="copy-hex-btn">Copy HEX</button>
            <button class="color-btn secondary" id="change-image-btn">Change Image</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Image Resize -->
    <div class="page" id="resize-page">
      <div class="tool-page">
        <a href="#" class="back-button">‚Üê Back to Home</a>
        <h1>Image Resize</h1>
        <p class="subtitle">Resize your images to any dimension</p>

        <div class="resize-upload" id="resize-upload-area">
          <label for="resize-file-input" class="upload-label">
            <div class="upload-icon">üìê</div>
            <div class="upload-text">Click to upload image or drag & drop</div>
          </label>
          <input type="file" id="resize-file-input" accept="image/*" />
        </div>

        <div id="resize-controls-container" style="display: none;">
          <div class="resize-info">
            Original size: <span id="original-size">-</span>
          </div>

          <div class="resize-controls">
            <div class="resize-input-group">
              <label>Width (px)</label>
              <input type="number" id="resize-width" min="1" placeholder="Width" />
            </div>
            <div class="resize-input-group">
              <label>Height (px)</label>
              <input type="number" id="resize-height" min="1" placeholder="Height" />
            </div>
            <div class="resize-input-group">
              <label>
                <input type="checkbox" id="maintain-ratio" checked style="width: auto; margin-right: 0.5rem;" />
                Maintain aspect ratio
              </label>
            </div>
          </div>

          <div class="resize-preview" id="resize-preview-container">
            <canvas id="resize-canvas" style="display: none;"></canvas>
          </div>

          <div class="resize-buttons">
            <button class="resize-btn" id="resize-apply-btn">Apply Resize</button>
            <button class="resize-btn" id="resize-download-btn" style="display: none;">Download</button>
            <button class="resize-btn secondary" id="resize-reset-btn">Reset</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Character Counter -->
    <div class="page" id="charcount-page">
      <div class="tool-page">
        <a href="#" class="back-button">‚Üê Back to Home</a>
        <h1>Character Counter</h1>
        <p class="subtitle">Count characters, words, and lines in real-time</p>

        <textarea id="charcount-textarea"
          style="width: 100%; min-height: 250px; padding: 1rem; border: 1px solid #ffd4dc; border-radius: 12px;
          font-size: 0.9375rem; outline: none; background: #fff5f7; color: #1a1a1a; transition: all 0.2s;
          font-family: inherit; resize: vertical; line-height: 1.6;"
          placeholder="Enter your text here..."
        ></textarea>

        <div class="color-info" style="margin-top: 1.5rem;">
          <div class="color-info-item">
            <div class="color-info-label">Characters</div>
            <div class="color-info-value" id="char-count">0</div>
          </div>
          <div class="color-info-item">
            <div class="color-info-label">Words</div>
            <div class="color-info-value" id="word-count">0</div>
          </div>
          <div class="color-info-item">
            <div class="color-info-label">Lines</div>
            <div class="color-info-value" id="line-count">0</div>
          </div>
          <div class="color-info-item">
            <div class="color-info-label">No Spaces</div>
            <div class="color-info-value" id="char-count-no-space">0</div>
          </div>
        </div>

        <div class="color-actions" style="margin-top: 1.5rem;">
          <button class="color-btn" id="copy-text-btn">Copy Text</button>
          <button class="color-btn secondary" id="clear-text-btn">Clear</button>
        </div>
      </div>
    </div>

    <!-- Image Crop -->
    <div class="page" id="imagecrop-page">
      <div class="tool-page">
        <a href="#" class="back-button">‚Üê Back to Home</a>
        <h1>Image Crop</h1>
        <p class="subtitle">Crop and trim your images</p>

        <div class="resize-upload" id="crop-upload-area">
          <label for="crop-file-input" class="upload-label">
            <div class="upload-icon">‚úÇÔ∏è</div>
            <div class="upload-text">Click to upload image or drag & drop</div>
          </label>
          <input type="file" id="crop-file-input" accept="image/*" style="display: none;" />
        </div>

        <div id="crop-controls-container" style="display: none;">
          <div class="resize-info" style="margin-bottom: 1rem;">
            Drag to select crop area
          </div>

          <div style="position: relative; display: inline-block; max-width: 100%; user-select: none;">
            <canvas id="crop-canvas" style="max-width: 100%; border: 1px solid #ffd4dc; border-radius: 12px; cursor: crosshair;"></canvas>
            <div id="crop-selection" style="position: absolute; border: 2px dashed #e63946; background: rgba(230, 57, 70, 0.1); pointer-events: none; display: none;"></div>
          </div>

          <div class="resize-buttons" style="margin-top: 1.5rem;">
            <button class="resize-btn" id="crop-apply-btn">Crop Image</button>
            <button class="resize-btn" id="crop-download-btn" style="display: none;">Download</button>
            <button class="resize-btn secondary" id="crop-reset-btn">Reset</button>
          </div>
        </div>
      </div>
    </div>

    <!-- ZIP Compress -->
    <div class="page" id="zipcompress-page">
      <div class="tool-page">
        <a href="#" class="back-button">‚Üê Back to Home</a>
        <h1>ZIP Compress</h1>
        <p class="subtitle">Compress multiple files into a ZIP archive</p>

        <div class="resize-upload" id="zip-upload-area">
          <label for="zip-file-input" class="upload-label">
            <div class="upload-icon">üóúÔ∏è</div>
            <div class="upload-text">Click to select files or drag & drop</div>
          </label>
          <input type="file" id="zip-file-input" multiple style="display: none;" />
        </div>

        <div id="zip-files-list" style="display: none; margin-top: 1.5rem;">
          <div class="resize-info">
            Selected files: <span id="zip-file-count">0</span>
          </div>
          <div id="zip-file-names" style="margin-top: 1rem; padding: 1rem; background: #fff5f7; border: 1px solid #ffd4dc; border-radius: 12px; max-height: 200px; overflow-y: auto; font-size: 0.875rem; color: #666;"></div>

          <div class="resize-buttons" style="margin-top: 1.5rem;">
            <button class="resize-btn" id="zip-compress-btn">Create ZIP</button>
            <button class="resize-btn secondary" id="zip-reset-btn">Reset</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Image Compress -->
    <div class="page" id="imagecompress-page">
      <div class="tool-page">
        <a href="#" class="back-button">‚Üê Back to Home</a>
        <h1>Image Compress</h1>
        <p class="subtitle">Reduce image file size with quality control</p>

        <div class="resize-upload" id="compress-upload-area">
          <label for="compress-file-input" class="upload-label">
            <div class="upload-icon">üì¶</div>
            <div class="upload-text">Click to upload image or drag & drop</div>
          </label>
          <input type="file" id="compress-file-input" accept="image/*" style="display: none;" />
        </div>

        <div id="compress-controls-container" style="display: none;">
          <div class="resize-info">
            Original size: <span id="compress-original-size">-</span>
          </div>

          <div class="resize-controls" style="margin-top: 1.5rem;">
            <div class="resize-input-group">
              <label>Quality (%)</label>
              <input type="range" id="compress-quality" min="1" max="100" value="80" style="width: 100%; margin-bottom: 0.5rem;" />
              <div style="text-align: center; font-size: 1.25rem; font-weight: 600; color: #e63946;" id="compress-quality-display">80%</div>
            </div>
          </div>

          <div class="resize-preview" id="compress-preview-container" style="margin-top: 1.5rem;">
            <canvas id="compress-canvas" style="display: none; max-width: 100%; border: 1px solid #ffd4dc; border-radius: 12px;"></canvas>
          </div>

          <div class="resize-info" style="margin-top: 1rem;">
            Compressed size: <span id="compress-new-size">-</span>
          </div>

          <div class="resize-buttons" style="margin-top: 1.5rem;">
            <button class="resize-btn" id="compress-apply-btn">Compress</button>
            <button class="resize-btn" id="compress-download-btn" style="display: none;">Download</button>
            <button class="resize-btn secondary" id="compress-reset-btn">Reset</button>
          </div>
        </div>
      </div>
    </div>
  </main>

  <!-- Error Modal -->
  <div class="error-modal" id="error-modal">
    <div class="error-modal-content">
      <div class="error-icon">‚ö†Ô∏è</div>
      <div class="error-title">Error</div>
      <div class="error-message" id="error-message"></div>
      <button class="error-btn" id="error-close-btn">OK</button>
    </div>
  </div>

  <script>
    const pages = {
      home: document.getElementById("home-page"),
      about: document.getElementById("about-page"),
      howto: document.getElementById("howto-page"),
      html: document.getElementById("html-page"),
      sb3: document.getElementById("sb3-page"),
      qr: document.getElementById("qr-page"),
      timer: document.getElementById("timer-page"),
      colorpicker: document.getElementById("colorpicker-page"),
      resize: document.getElementById("resize-page"),
      charcount: document.getElementById("charcount-page"),
      imagecrop: document.getElementById("imagecrop-page"),
      zipcompress: document.getElementById("zipcompress-page"),
      imagecompress: document.getElementById("imagecompress-page")
    };

    // Error modal
    const errorModal = document.getElementById("error-modal");
    const errorMessage = document.getElementById("error-message");
    const errorCloseBtn = document.getElementById("error-close-btn");

    function showError(message) {
      errorMessage.textContent = message;
      errorModal.classList.add("show");
    }

    function hideError() {
      errorModal.classList.remove("show");
    }

    errorCloseBtn.addEventListener("click", hideError);

    errorModal.addEventListener("click", (e) => {
      if (e.target === errorModal) {
        hideError();
      }
    });

    // Tools dropdown
    const toolsBtn = document.getElementById("tools-btn");
    const toolsMenu = document.getElementById("tools-menu");

    toolsBtn.addEventListener("click", (e) => {
      e.stopPropagation();
      toolsMenu.classList.toggle("show");
    });

    document.addEventListener("click", () => {
      toolsMenu.classList.remove("show");
    });

    toolsMenu.addEventListener("click", (e) => {
      e.stopPropagation();
    });

    // Navigation
    function showPage(pageName) {
      Object.values(pages).forEach(page => {
        page.classList.remove("active");
      });

      setTimeout(() => {
        pages[pageName].classList.add("active");
      }, 50);

      toolsMenu.classList.remove("show");
      window.scrollTo(0, 0);
    }

    // Tool cards click
    document.querySelectorAll(".tool-card").forEach(card => {
      card.addEventListener("click", () => {
        const tool = card.getAttribute("data-tool");
        showPage(tool);
      });
    });

    // Dropdown items click
    document.querySelectorAll(".dropdown-item").forEach(item => {
      item.addEventListener("click", () => {
        const tool = item.getAttribute("data-tool");
        if (tool) {
          showPage(tool);
        }
      });
    });

    // More Tools button
    document.getElementById("more-tools-btn").addEventListener("click", () => {
      showPage("home");
    });

    // Back buttons
    document.querySelectorAll(".back-button").forEach(btn => {
      btn.addEventListener("click", (e) => {
        e.preventDefault();
        showPage("home");
      });
    });

    // Logo link
    document.getElementById("site-logo-link").addEventListener("click", (e) => {
      e.preventDefault();
      showPage("home");
    });

    // About and How to use links
    document.getElementById("about-link").addEventListener("click", () => {
      showPage("about");
    });

    document.getElementById("howto-link").addEventListener("click", () => {
      showPage("howto");
    });

    // HTML Form - iframeÊñπÂºè„Åß„ÉÄ„Ç¶„É≥„É≠„Éº„Éâ
    document.getElementById("html-form").addEventListener("submit", async (e) => {
      e.preventDefault();
      const form = e.target;
      const submitBtn = form.querySelector('button[type="submit"]');
      const urlInput = form.querySelector('input[name="url"]');
      let url = urlInput.value.trim();

      // ÂÖ•Âäõ„ÉÅ„Çß„ÉÉ„ÇØ
      if (!url) {
        showError("Please enter a URL.");
        return;
      }

      // https:// „ÅÆËá™ÂãïË£úÂÆå
      if (!/^https?:\/\//i.test(url)) {
        url = "https://" + url;
      }

      // URLÂΩ¢Âºè„ÅÆÁ∞°Êòì„ÉÅ„Çß„ÉÉ„ÇØ
      try {
        new URL(url);
      } catch (err) {
        showError("Please enter a valid URL.");
        return;
      }

      // „É≠„Éº„Éá„Ç£„É≥„Ç∞ÈñãÂßã
      submitBtn.classList.add('loading');
      submitBtn.disabled = true;

      const XGD_API_KEY = "8e31dd604cd0989aaa6ad94aa319b32f";

      try {
        // URLÁü≠Á∏ÆAPIÂëº„Å≥Âá∫„Åó
        const apiUrl = `https://xgd.io/V1/shorten?url=${encodeURIComponent(url)}&key=${XGD_API_KEY}`;
        const res = await fetch(apiUrl);

        if (!res.ok) {
          submitBtn.classList.remove('loading');
          submitBtn.disabled = false;
          showError("Could not connect to URL shortening service.");
          return;
        }

        const data = await res.json();

        // Áü≠Á∏ÆURLÂèñÂæó„ÅÆÊ§úË®º
        if (data.status !== 200 || !data.shorturl) {
          submitBtn.classList.remove('loading');
          submitBtn.disabled = false;
          showError("Failed to shorten URL. Please enter a valid URL.");
          return;
        }

        const shortUrl = data.shorturl;
        const downloadUrl = `/download?url=${encodeURIComponent(shortUrl)}`;

        // fetch„Åß„Ç®„É©„Éº„ÉÅ„Çß„ÉÉ„ÇØÔºà„Çø„Ç§„É†„Ç¢„Ç¶„Éà‰ªò„ÅçÔºâ
        const controller = new AbortController();
        const timeoutId = setTimeout(() => {
          controller.abort();
        }, 20000); // 20Áßí„ÅÆ„Çø„Ç§„É†„Ç¢„Ç¶„Éà

        let checkRes;
        try {
          checkRes = await fetch(downloadUrl, {
            signal: controller.signal
          });
          clearTimeout(timeoutId);
        } catch (fetchErr) {
          clearTimeout(timeoutId);
          submitBtn.classList.remove('loading');
          submitBtn.disabled = false;

          if (fetchErr.name === 'AbortError') {
            showError("Connection timed out. Please try again.");
          } else {
            showError("Network error occurred. Please check your connection.");
          }
          return;
        }

        // „Çπ„ÉÜ„Éº„Çø„Çπ„Ç≥„Éº„Éâ„Çí„ÉÅ„Çß„ÉÉ„ÇØ
        if (!checkRes.ok) {
          const errorText = await checkRes.text();
          submitBtn.classList.remove('loading');
          submitBtn.disabled = false;
          showError(errorText || "Failed to fetch HTML. Please check the URL.");
          return;
        }

        // Content-Type„Çí„ÉÅ„Çß„ÉÉ„ÇØ
        const contentType = checkRes.headers.get('content-type');

        // text/plain„ÅÆÂ†¥Âêà„ÅØ„Ç®„É©„Éº„É°„ÉÉ„Çª„Éº„Ç∏„ÅÆÂèØËÉΩÊÄß„ÅåÈ´ò„ÅÑ
        if (contentType && contentType.includes('text/plain')) {
          const errorText = await checkRes.text();
          submitBtn.classList.remove('loading');
          submitBtn.disabled = false;
          showError(errorText);
          return;
        }

        // „ÉÄ„Ç¶„É≥„É≠„Éº„ÉâÊàêÂäü - Èö†„Åóiframe„ÅßÂÆüË°å
        const iframe = document.createElement('iframe');
        iframe.style.display = 'none';
        iframe.src = downloadUrl;
        document.body.appendChild(iframe);

        // „É≠„Éº„Éá„Ç£„É≥„Ç∞ÁµÇ‰∫Ü
        setTimeout(() => {
          submitBtn.classList.remove('loading');
          submitBtn.disabled = false;
          document.body.removeChild(iframe);
        }, 3000);

      } catch (err) {
        console.error("HTML Download Error:", err);
        submitBtn.classList.remove('loading');
        submitBtn.disabled = false;
        showError("An error occurred. Please try again.");
      }
    });

    // SB3 Form
    document.getElementById("sb3-form").addEventListener("submit", (e) => {
      e.preventDefault();
      const form = e.target;
      const submitBtn = form.querySelector('button[type="submit"]');
      let input = document.getElementById("scratch-id").value.trim();

      if (!input) return showError("Please enter a project ID or URL.");
      const match = input.match(/projects\/(\d+)/);
      const projectId = match ? match[1] : input.replace(/\D/g, "");
      if (!projectId) return showError("Please enter a valid project ID or URL.");

      // „É≠„Éº„Éá„Ç£„É≥„Ç∞ÈñãÂßã
      submitBtn.classList.add('loading');
      submitBtn.disabled = true;

      window.location.href = `/scratch-download/${projectId}`;

      // 3ÁßíÂæå„Å´„É≠„Éº„Éá„Ç£„É≥„Ç∞ÁµÇ‰∫ÜÔºà„Éö„Éº„Ç∏ÈÅ∑Áßª„Åô„Çã„ÅÆ„ÅßÂÆüÈöõ„Å´„ÅØ‰∏çË¶Å„Å†„ÅåÂøµ„ÅÆ„Åü„ÇÅÔºâ
      setTimeout(() => {
        submitBtn.classList.remove('loading');
        submitBtn.disabled = false;
      }, 3000);
    });

    // QR Form
    document.getElementById("qr-form").addEventListener("submit", (e) => {
      e.preventDefault();
      const form = e.target;
      const submitBtn = form.querySelector('button[type="submit"]');
      let text = document.getElementById("qr-text").value.trim();

      if (!text) return showError("Please enter text or URL.");
      if (/^[\w.-]+\.[a-z]{2,}/i.test(text) && !/^https?:\/\//i.test(text)) {
        text = "https://" + text;
      }

      // „É≠„Éº„Éá„Ç£„É≥„Ç∞ÈñãÂßã
      submitBtn.classList.add('loading');
      submitBtn.disabled = true;

      window.location.href = `/qrcode?text=${encodeURIComponent(text)}`;

      // 3ÁßíÂæå„Å´„É≠„Éº„Éá„Ç£„É≥„Ç∞ÁµÇ‰∫Ü
      setTimeout(() => {
        submitBtn.classList.remove('loading');
        submitBtn.disabled = false;
      }, 3000);
    });

    // Web Timer
    let timerInterval = null;
    let totalSeconds = 0;
    let isRunning = false;

    function initTimer() {
      const timerDisplay = document.getElementById("timer-display");
      const timerStatus = document.getElementById("timer-status");
      const hoursInput = document.getElementById("timer-hours");
      const minutesInput = document.getElementById("timer-minutes");
      const secondsInput = document.getElementById("timer-seconds");
      const startBtn = document.getElementById("timer-start");
      const resetBtn = document.getElementById("timer-reset");

      if (!timerDisplay || !startBtn || !resetBtn) return;

      function formatTime(seconds) {
        const h = Math.floor(seconds / 3600);
        const m = Math.floor((seconds % 3600) / 60);
        const s = seconds % 60;
        return `${String(h).padStart(2, '0')}:${String(m).padStart(2, '0')}:${String(s).padStart(2, '0')}`;
      }

      function updateDisplay() {
        timerDisplay.textContent = formatTime(totalSeconds);
      }

      function startTimer() {
        if (isRunning) {
          // Pause
          clearInterval(timerInterval);
          isRunning = false;
          startBtn.textContent = "Resume";
          timerStatus.textContent = "Paused";
          timerStatus.classList.remove("active");
        } else {
          // Start or Resume
          if (totalSeconds === 0 && !isRunning) {
            // Êñ∞„Åó„ÅÑ„Çø„Ç§„Éû„Éº„ÇíÈñãÂßã
            const hours = parseInt(hoursInput.value) || 0;
            const minutes = parseInt(minutesInput.value) || 0;
            const seconds = parseInt(secondsInput.value) || 0;
            totalSeconds = hours * 3600 + minutes * 60 + seconds;

            if (totalSeconds === 0) {
              showError("Please set timer duration.");
              return;
            }
          }

          isRunning = true;
          startBtn.textContent = "Pause";
          timerStatus.textContent = "Running...";
          timerStatus.classList.add("active");

          timerInterval = setInterval(() => {
            totalSeconds--;
            updateDisplay();

            if (totalSeconds <= 0) {
              clearInterval(timerInterval);
              isRunning = false;
              startBtn.textContent = "Start";
              timerStatus.textContent = "Time's up! ‚è∞";
              timerStatus.classList.remove("active");

              // „Ç¢„É©„Éº„ÉàÈü≥Ôºà„Éñ„É©„Ç¶„Ç∂„ÅÆ„Éá„Éï„Ç©„É´„ÉàÔºâ
              if (typeof Audio !== 'undefined') {
                try {
                  const audio = new Audio('data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBiqO1fPTgjMGHGq+7+OZURMKR5/g8r1sIQYqjdXz1IQ0Bh1rwO/lmlETCkeQ3vK8ayEGKo3V89SENAYda8Dv5ZpREwpHkN7yvGshBiqN1fPUhDQGHWvA7+WaURMKR5De8rxrIQYqjdXz1IQ0Bh1rwO/lmlETCkeQ3vK8ayEGKo3V89SENAYda8Dv5ZpREwpHkN7yvGshBiqN1fPUhDQGHWvA7+WaURMK');
                  audio.play();
                } catch (e) {
                  console.log("Audio play failed");
                }
              }
            }
          }, 1000);

          updateDisplay();
        }
      }

      function resetTimer() {
        clearInterval(timerInterval);
        isRunning = false;
        totalSeconds = 0;
        updateDisplay();
        startBtn.textContent = "Start";
        timerStatus.textContent = "";
        timerStatus.classList.remove("active");
        hoursInput.value = 0;
        minutesInput.value = 0;
        secondsInput.value = 0;
      }

      startBtn.addEventListener("click", startTimer);
      resetBtn.addEventListener("click", resetTimer);

      // ÂÖ•ÂäõÂÄ§„ÅÆÂà∂Èôê
      [hoursInput, minutesInput, secondsInput].forEach(input => {
        input.addEventListener("input", () => {
          const max = parseInt(input.max);
          const min = parseInt(input.min);
          let value = parseInt(input.value);

          if (value > max) input.value = max;
          if (value < min) input.value = min;
        });
      });
    }

    // „Éö„Éº„Ç∏Âàá„ÇäÊõø„ÅàÊôÇ„Å´ÂàùÊúüÂåñ
    const originalShowPage = showPage;
    showPage = function(pageName) {
      originalShowPage(pageName);
      if (pageName === 'timer') {
        setTimeout(initTimer, 100);
      } else if (pageName === 'colorpicker') {
        setTimeout(initColorPicker, 100);
      } else if (pageName === 'resize') {
        setTimeout(initImageResize, 100);
      } else if (pageName === 'charcount') {
        setTimeout(initCharCounter, 100);
      } else if (pageName === 'imagecrop') {
        setTimeout(initImageCrop, 100);
      } else if (pageName === 'zipcompress') {
        setTimeout(initZipCompress, 100);
      } else if (pageName === 'imagecompress') {
        setTimeout(initImageCompress, 100);
      }
    };

    // Color Picker
    function initColorPicker() {
      const fileInput = document.getElementById('color-file-input');
      const uploadArea = document.getElementById('color-upload-area');
      const canvas = document.getElementById('color-canvas');
      const canvasContainer = document.getElementById('color-canvas-container');
      const colorPreview = document.getElementById('color-preview');
      const colorHex = document.getElementById('color-hex');
      const colorRgb = document.getElementById('color-rgb');
      const copyHexBtn = document.getElementById('copy-hex-btn');
      const changeImageBtn = document.getElementById('change-image-btn');

      if (!canvas || !fileInput) return;

      const ctx = canvas.getContext('2d');
      let currentImage = null;

      // „Éï„Ç°„Ç§„É´ÈÅ∏ÊäûÊôÇ„ÅÆÂá¶ÁêÜ
      fileInput.addEventListener('change', (e) => {
        const file = e.target.files[0];
        if (file) {
          loadImage(file);
        }
      });

      // „Éâ„É©„ÉÉ„Ç∞&„Éâ„É≠„ÉÉ„ÉóÂØæÂøú
      uploadArea.addEventListener('dragover', (e) => {
        e.preventDefault();
        uploadArea.style.borderColor = '#e63946';
      });

      uploadArea.addEventListener('dragleave', () => {
        uploadArea.style.borderColor = '#ffd4dc';
      });

      uploadArea.addEventListener('drop', (e) => {
        e.preventDefault();
        uploadArea.style.borderColor = '#ffd4dc';
        const file = e.dataTransfer.files[0];
        if (file && file.type.startsWith('image/')) {
          loadImage(file);
        }
      });

      // ÁîªÂÉè„ÇíË™≠„ÅøËæº„ÇÄ
      function loadImage(file) {
        const reader = new FileReader();
        reader.onload = (e) => {
          const img = new Image();
          img.onload = () => {
            currentImage = img;

            // „Ç≠„É£„É≥„Éê„Çπ„Çµ„Ç§„Ç∫„ÇíÁîªÂÉè„Å´Âêà„Çè„Åõ„ÇãÔºàÊúÄÂ§ßÂπÖ500pxÔºâ
            const maxWidth = 500;
            let width = img.width;
            let height = img.height;

            if (width > maxWidth) {
              height = (height * maxWidth) / width;
              width = maxWidth;
            }

            canvas.width = width;
            canvas.height = height;

            // ÁîªÂÉè„ÇíÊèèÁîª
            ctx.drawImage(img, 0, 0, width, height);

            // UI„ÇíÊõ¥Êñ∞
            uploadArea.style.display = 'none';
            canvasContainer.style.display = 'block';
          };
          img.src = e.target.result;
        };
        reader.readAsDataURL(file);
      }

      // „Ç≠„É£„É≥„Éê„Çπ„ÇØ„É™„ÉÉ„ÇØÊôÇ„ÅÆËâ≤ÂèñÂæó
      canvas.addEventListener('click', (e) => {
        if (!currentImage) return;

        const rect = canvas.getBoundingClientRect();
        const x = Math.floor((e.clientX - rect.left) * (canvas.width / rect.width));
        const y = Math.floor((e.clientY - rect.top) * (canvas.height / rect.height));

        // „Éî„ÇØ„Çª„É´„Éá„Éº„Çø„ÇíÂèñÂæó
        const imageData = ctx.getImageData(x, y, 1, 1);
        const pixel = imageData.data;

        const r = pixel[0];
        const g = pixel[1];
        const b = pixel[2];

        // HEX„Å´Â§âÊèõ
        const hex = '#' + [r, g, b].map(x => {
          const hexValue = x.toString(16);
          return hexValue.length === 1 ? '0' + hexValue : hexValue;
        }).join('');

        // RGB„Éï„Ç©„Éº„Éû„ÉÉ„Éà
        const rgb = `rgb(${r}, ${g}, ${b})`;

        // UI„ÇíÊõ¥Êñ∞
        colorPreview.style.backgroundColor = hex;
        colorHex.textContent = hex.toUpperCase();
        colorRgb.textContent = rgb;
      });

      // HEX„Ç≥„Éî„Éº„Éú„Çø„É≥
      copyHexBtn.addEventListener('click', async () => {
        const hex = colorHex.textContent;
        try {
          await navigator.clipboard.writeText(hex);
          const originalText = copyHexBtn.textContent;
          copyHexBtn.textContent = 'Copied!';
          setTimeout(() => {
            copyHexBtn.textContent = originalText;
          }, 2000);
        } catch (err) {
          showError('Failed to copy.');
        }
      });

      // ÁîªÂÉèÂ§âÊõ¥„Éú„Çø„É≥
      changeImageBtn.addEventListener('click', () => {
        uploadArea.style.display = 'block';
        canvasContainer.style.display = 'none';
        fileInput.value = '';
        currentImage = null;
        colorPreview.style.backgroundColor = '#000000';
        colorHex.textContent = '#000000';
        colorRgb.textContent = 'rgb(0, 0, 0)';
      });
    }

    // Image Resize
    function initImageResize() {
      const fileInput = document.getElementById('resize-file-input');
      const uploadArea = document.getElementById('resize-upload-area');
      const controlsContainer = document.getElementById('resize-controls-container');
      const widthInput = document.getElementById('resize-width');
      const heightInput = document.getElementById('resize-height');
      const maintainRatio = document.getElementById('maintain-ratio');
      const canvas = document.getElementById('resize-canvas');
      const originalSizeSpan = document.getElementById('original-size');
      const applyBtn = document.getElementById('resize-apply-btn');
      const downloadBtn = document.getElementById('resize-download-btn');
      const resetBtn = document.getElementById('resize-reset-btn');

      if (!canvas || !fileInput) return;

      const ctx = canvas.getContext('2d');
      let originalImage = null;
      let originalWidth = 0;
      let originalHeight = 0;

      // „Éï„Ç°„Ç§„É´ÈÅ∏Êäû
      fileInput.addEventListener('change', (e) => {
        const file = e.target.files[0];
        if (file) loadImage(file);
      });

      // „Éâ„É©„ÉÉ„Ç∞&„Éâ„É≠„ÉÉ„Éó
      uploadArea.addEventListener('dragover', (e) => {
        e.preventDefault();
        uploadArea.style.borderColor = '#e63946';
      });

      uploadArea.addEventListener('dragleave', () => {
        uploadArea.style.borderColor = '#ffd4dc';
      });

      uploadArea.addEventListener('drop', (e) => {
        e.preventDefault();
        uploadArea.style.borderColor = '#ffd4dc';
        const file = e.dataTransfer.files[0];
        if (file && file.type.startsWith('image/')) {
          loadImage(file);
        }
      });

      function loadImage(file) {
        const reader = new FileReader();
        reader.onload = (e) => {
          const img = new Image();
          img.onload = () => {
            originalImage = img;
            originalWidth = img.width;
            originalHeight = img.height;

            widthInput.value = originalWidth;
            heightInput.value = originalHeight;
            originalSizeSpan.textContent = `${originalWidth} x ${originalHeight}px`;

            canvas.width = originalWidth;
            canvas.height = originalHeight;
            ctx.drawImage(img, 0, 0);
            canvas.style.display = 'block';

            uploadArea.style.display = 'none';
            controlsContainer.style.display = 'block';
            downloadBtn.style.display = 'none';
          };
          img.src = e.target.result;
        };
        reader.readAsDataURL(file);
      }

      // Á∏¶Ê®™ÊØîÁ∂≠ÊåÅ
      let isUpdating = false;
      widthInput.addEventListener('input', () => {
        if (!maintainRatio.checked || isUpdating) return;
        isUpdating = true;
        const ratio = originalHeight / originalWidth;
        heightInput.value = Math.round(widthInput.value * ratio);
        isUpdating = false;
      });

      heightInput.addEventListener('input', () => {
        if (!maintainRatio.checked || isUpdating) return;
        isUpdating = true;
        const ratio = originalWidth / originalHeight;
        widthInput.value = Math.round(heightInput.value * ratio);
        isUpdating = false;
      });

      // „É™„Çµ„Ç§„Ç∫ÈÅ©Áî®
      applyBtn.addEventListener('click', () => {
        if (!originalImage) return;

        const newWidth = parseInt(widthInput.value);
        const newHeight = parseInt(heightInput.value);

        if (!newWidth || !newHeight || newWidth < 1 || newHeight < 1) {
          showError('Please enter valid dimensions.');
          return;
        }

        canvas.width = newWidth;
        canvas.height = newHeight;
        ctx.drawImage(originalImage, 0, 0, newWidth, newHeight);

        downloadBtn.style.display = 'block';
      });

      // „ÉÄ„Ç¶„É≥„É≠„Éº„Éâ
      let isResizeDownloading = false;
      downloadBtn.addEventListener('click', () => {
        if (isResizeDownloading) return;
        isResizeDownloading = true;

        canvas.toBlob((blob) => {
          const url = URL.createObjectURL(blob);
          const a = document.createElement('a');
          a.href = url;
          a.download = `resized_${Date.now()}.png`;
          a.click();
          URL.revokeObjectURL(url);
          setTimeout(() => { isResizeDownloading = false; }, 1000);
        });
      });

      // „É™„Çª„ÉÉ„Éà
      resetBtn.addEventListener('click', () => {
        uploadArea.style.display = 'block';
        controlsContainer.style.display = 'none';
        fileInput.value = '';
        originalImage = null;
        canvas.style.display = 'none';
        downloadBtn.style.display = 'none';
      });
    }

    // Character Counter
    function initCharCounter() {
      const textarea = document.getElementById('charcount-textarea');
      const charCount = document.getElementById('char-count');
      const wordCount = document.getElementById('word-count');
      const lineCount = document.getElementById('line-count');
      const charCountNoSpace = document.getElementById('char-count-no-space');
      const copyBtn = document.getElementById('copy-text-btn');
      const clearBtn = document.getElementById('clear-text-btn');

      if (!textarea || !charCount) return;

      function updateCounts() {
        const text = textarea.value;

        // ÊñáÂ≠óÊï∞
        charCount.textContent = text.length;

        // Á©∫ÁôΩ„Å™„ÅóÊñáÂ≠óÊï∞
        const noSpaceText = text.replace(/\s/g, '');
        charCountNoSpace.textContent = noSpaceText.length;

        // ÂçòË™ûÊï∞ÔºàÁ©∫ÁôΩÂå∫Âàá„Çä„ÄÅÊó•Êú¨Ë™û„ÅØÊñáÂ≠óÂçò‰ΩçÔºâ
        const words = text.trim().split(/\s+/).filter(w => w.length > 0);
        wordCount.textContent = words.length || 0;

        // Ë°åÊï∞
        const lines = text.split('\n').length;
        lineCount.textContent = lines;
      }

      // „É™„Ç¢„É´„Çø„Ç§„É†Êõ¥Êñ∞
      textarea.addEventListener('input', updateCounts);

      // „ÉÜ„Ç≠„Çπ„Éà„Ç®„É™„Ç¢„Éï„Ç©„Éº„Ç´„ÇπÊôÇ„ÅÆ„Çπ„Çø„Ç§„É´
      textarea.addEventListener('focus', () => {
        textarea.style.background = 'white';
        textarea.style.borderColor = '#e63946';
        textarea.style.boxShadow = '0 0 0 3px rgba(230, 57, 70, 0.1)';
      });

      textarea.addEventListener('blur', () => {
        textarea.style.background = '#fff5f7';
        textarea.style.borderColor = '#ffd4dc';
        textarea.style.boxShadow = 'none';
      });

      // „Ç≥„Éî„Éº„Éú„Çø„É≥
      copyBtn.addEventListener('click', async () => {
        const text = textarea.value;
        if (!text) {
          showError('No text to copy.');
          return;
        }

        try {
          await navigator.clipboard.writeText(text);
          const originalText = copyBtn.textContent;
          copyBtn.textContent = 'Copied!';
          setTimeout(() => {
            copyBtn.textContent = originalText;
          }, 2000);
        } catch (err) {
          showError('Failed to copy.');
        }
      });

      // „ÇØ„É™„Ç¢„Éú„Çø„É≥
      clearBtn.addEventListener('click', () => {
        textarea.value = '';
        updateCounts();
        textarea.focus();
      });

      // ÂàùÊúü„Ç´„Ç¶„É≥„Éà
      updateCounts();
    }

    // Image Crop
    function initImageCrop() {
      const fileInput = document.getElementById('crop-file-input');
      const uploadArea = document.getElementById('crop-upload-area');
      const controlsContainer = document.getElementById('crop-controls-container');
      const canvas = document.getElementById('crop-canvas');
      const selection = document.getElementById('crop-selection');
      const applyBtn = document.getElementById('crop-apply-btn');
      const downloadBtn = document.getElementById('crop-download-btn');
      const resetBtn = document.getElementById('crop-reset-btn');

      if (!canvas || !fileInput) return;

      const ctx = canvas.getContext('2d');
      let originalImage = null;
      let cropData = { startX: 0, startY: 0, width: 0, height: 0 };
      let isSelecting = false;
      let canCrop = true;
      let mouseDownHandler, mouseMoveHandler, mouseUpHandler;

      // Remove old event listeners if they exist
      if (canvas._cropInitialized) return;
      canvas._cropInitialized = true;

      fileInput.addEventListener('change', (e) => {
        const file = e.target.files[0];
        if (file) loadImage(file);
      });

      uploadArea.addEventListener('dragover', (e) => {
        e.preventDefault();
        uploadArea.style.borderColor = '#e63946';
      });

      uploadArea.addEventListener('dragleave', () => {
        uploadArea.style.borderColor = '#ffd4dc';
      });

      uploadArea.addEventListener('drop', (e) => {
        e.preventDefault();
        uploadArea.style.borderColor = '#ffd4dc';
        const file = e.dataTransfer.files[0];
        if (file && file.type.startsWith('image/')) {
          loadImage(file);
        }
      });

      function loadImage(file) {
        const reader = new FileReader();
        reader.onload = (e) => {
          const img = new Image();
          img.onload = () => {
            originalImage = img;
            const maxWidth = 500;
            let width = img.width;
            let height = img.height;

            if (width > maxWidth) {
              height = (height * maxWidth) / width;
              width = maxWidth;
            }

            canvas.width = width;
            canvas.height = height;
            ctx.drawImage(img, 0, 0, width, height);

            uploadArea.style.display = 'none';
            controlsContainer.style.display = 'block';
            downloadBtn.style.display = 'none';
            selection.style.display = 'none';
            canCrop = true;
            attachCropEvents();
          };
          img.src = e.target.result;
        };
        reader.readAsDataURL(file);
      }

      function attachCropEvents() {
        removeCropEvents();

        mouseDownHandler = (e) => {
          if (!canCrop) return;
          const rect = canvas.getBoundingClientRect();
          cropData.startX = e.clientX - rect.left;
          cropData.startY = e.clientY - rect.top;
          isSelecting = true;
          selection.style.display = 'block';
        };

        mouseMoveHandler = (e) => {
          if (!isSelecting || !canCrop) return;
          const rect = canvas.getBoundingClientRect();
          const currentX = e.clientX - rect.left;
          const currentY = e.clientY - rect.top;

          cropData.width = currentX - cropData.startX;
          cropData.height = currentY - cropData.startY;

          const parent = canvas.parentElement;
          selection.style.left = Math.min(cropData.startX, currentX) + 'px';
          selection.style.top = Math.min(cropData.startY, currentY) + 'px';
          selection.style.width = Math.abs(cropData.width) + 'px';
          selection.style.height = Math.abs(cropData.height) + 'px';
        };

        mouseUpHandler = () => {
          isSelecting = false;
        };

        canvas.addEventListener('mousedown', mouseDownHandler);
        canvas.addEventListener('mousemove', mouseMoveHandler);
        canvas.addEventListener('mouseup', mouseUpHandler);
      }

      function removeCropEvents() {
        if (mouseDownHandler) canvas.removeEventListener('mousedown', mouseDownHandler);
        if (mouseMoveHandler) canvas.removeEventListener('mousemove', mouseMoveHandler);
        if (mouseUpHandler) canvas.removeEventListener('mouseup', mouseUpHandler);
      }

      applyBtn.addEventListener('click', () => {
        if (!originalImage || Math.abs(cropData.width) < 10 || Math.abs(cropData.height) < 10) {
          showError('Please select a crop area.');
          return;
        }

        const scaleX = canvas.width / canvas.getBoundingClientRect().width;
        const scaleY = canvas.height / canvas.getBoundingClientRect().height;

        const x = Math.min(cropData.startX, cropData.startX + cropData.width) * scaleX;
        const y = Math.min(cropData.startY, cropData.startY + cropData.height) * scaleY;
        const w = Math.abs(cropData.width) * scaleX;
        const h = Math.abs(cropData.height) * scaleY;

        const croppedCanvas = document.createElement('canvas');
        croppedCanvas.width = w;
        croppedCanvas.height = h;
        const croppedCtx = croppedCanvas.getContext('2d');

        croppedCtx.drawImage(canvas, x, y, w, h, 0, 0, w, h);

        canvas.width = w;
        canvas.height = h;
        ctx.clearRect(0, 0, w, h);
        ctx.drawImage(croppedCanvas, 0, 0);

        selection.style.display = 'none';
        canvas.style.cursor = 'default';
        canCrop = false;
        removeCropEvents();
        downloadBtn.style.display = 'block';
      });

      let isDownloading = false;
      downloadBtn.addEventListener('click', () => {
        if (isDownloading) return;
        isDownloading = true;

        canvas.toBlob((blob) => {
          const url = URL.createObjectURL(blob);
          const a = document.createElement('a');
          a.href = url;
          a.download = `cropped_${Date.now()}.png`;
          a.click();
          URL.revokeObjectURL(url);
          setTimeout(() => { isDownloading = false; }, 1000);
        });
      });

      resetBtn.addEventListener('click', () => {
        uploadArea.style.display = 'block';
        controlsContainer.style.display = 'none';
        fileInput.value = '';
        originalImage = null;
        selection.style.display = 'none';
        downloadBtn.style.display = 'none';
        canCrop = true;
        canvas.style.cursor = 'crosshair';
        removeCropEvents();
      });
    }

    // ZIP Compress
    function initZipCompress() {
      const fileInput = document.getElementById('zip-file-input');
      const uploadArea = document.getElementById('zip-upload-area');
      const filesList = document.getElementById('zip-files-list');
      const fileCount = document.getElementById('zip-file-count');
      const fileNames = document.getElementById('zip-file-names');
      const compressBtn = document.getElementById('zip-compress-btn');
      const resetBtn = document.getElementById('zip-reset-btn');

      if (!fileInput) return;

      let selectedFiles = [];

      fileInput.addEventListener('change', (e) => {
        selectedFiles = Array.from(e.target.files);
        displayFiles();
      });

      uploadArea.addEventListener('dragover', (e) => {
        e.preventDefault();
        uploadArea.style.borderColor = '#e63946';
      });

      uploadArea.addEventListener('dragleave', () => {
        uploadArea.style.borderColor = '#ffd4dc';
      });

      uploadArea.addEventListener('drop', (e) => {
        e.preventDefault();
        uploadArea.style.borderColor = '#ffd4dc';
        selectedFiles = Array.from(e.dataTransfer.files);
        displayFiles();
      });

      function displayFiles() {
        if (selectedFiles.length === 0) return;

        fileCount.textContent = selectedFiles.length;
        fileNames.innerHTML = selectedFiles.map(f => `‚Ä¢ ${f.name}`).join('<br>');
        uploadArea.style.display = 'none';
        filesList.style.display = 'block';
      }

      compressBtn.addEventListener('click', async () => {
        if (selectedFiles.length === 0) {
          showError('Please select files to compress.');
          return;
        }

        if (typeof JSZip === 'undefined') {
          showError('ZIP library not loaded. Please refresh the page.');
          return;
        }

        try {
          const zip = new JSZip();

          for (const file of selectedFiles) {
            zip.file(file.name, file);
          }

          const blob = await zip.generateAsync({ type: 'blob' });
          const url = URL.createObjectURL(blob);
          const a = document.createElement('a');
          a.href = url;
          a.download = `archive_${Date.now()}.zip`;
          a.click();
          URL.revokeObjectURL(url);
        } catch (err) {
          showError('Failed to create ZIP file.');
        }
      });

      resetBtn.addEventListener('click', () => {
        uploadArea.style.display = 'block';
        filesList.style.display = 'none';
        fileInput.value = '';
        selectedFiles = [];
      });
    }

    // Image Compress
    function initImageCompress() {
      const fileInput = document.getElementById('compress-file-input');
      const uploadArea = document.getElementById('compress-upload-area');
      const controlsContainer = document.getElementById('compress-controls-container');
      const canvas = document.getElementById('compress-canvas');
      const qualitySlider = document.getElementById('compress-quality');
      const qualityDisplay = document.getElementById('compress-quality-display');
      const originalSizeSpan = document.getElementById('compress-original-size');
      const newSizeSpan = document.getElementById('compress-new-size');
      const applyBtn = document.getElementById('compress-apply-btn');
      const downloadBtn = document.getElementById('compress-download-btn');
      const resetBtn = document.getElementById('compress-reset-btn');

      if (!canvas || !fileInput) return;

      const ctx = canvas.getContext('2d');
      let originalImage = null;
      let originalFileSize = 0;
      let compressedBlob = null;

      fileInput.addEventListener('change', (e) => {
        const file = e.target.files[0];
        if (file) loadImage(file);
      });

      uploadArea.addEventListener('dragover', (e) => {
        e.preventDefault();
        uploadArea.style.borderColor = '#e63946';
      });

      uploadArea.addEventListener('dragleave', () => {
        uploadArea.style.borderColor = '#ffd4dc';
      });

      uploadArea.addEventListener('drop', (e) => {
        e.preventDefault();
        uploadArea.style.borderColor = '#ffd4dc';
        const file = e.dataTransfer.files[0];
        if (file && file.type.startsWith('image/')) {
          loadImage(file);
        }
      });

      function loadImage(file) {
        originalFileSize = file.size;
        const reader = new FileReader();
        reader.onload = (e) => {
          const img = new Image();
          img.onload = () => {
            originalImage = img;
            canvas.width = img.width;
            canvas.height = img.height;
            ctx.drawImage(img, 0, 0);
            canvas.style.display = 'block';

            originalSizeSpan.textContent = formatFileSize(originalFileSize);
            uploadArea.style.display = 'none';
            controlsContainer.style.display = 'block';
            downloadBtn.style.display = 'none';
            newSizeSpan.textContent = '-';
          };
          img.src = e.target.result;
        };
        reader.readAsDataURL(file);
      }

      qualitySlider.addEventListener('input', () => {
        qualityDisplay.textContent = qualitySlider.value + '%';
      });

      function formatFileSize(bytes) {
        if (bytes < 1024) return bytes + ' B';
        if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(2) + ' KB';
        return (bytes / (1024 * 1024)).toFixed(2) + ' MB';
      }

      applyBtn.addEventListener('click', () => {
        if (!originalImage) return;

        const quality = qualitySlider.value / 100;
        canvas.toBlob((blob) => {
          compressedBlob = blob;
          newSizeSpan.textContent = formatFileSize(blob.size);
          downloadBtn.style.display = 'block';
        }, 'image/jpeg', quality);
      });

      let isCompressDownloading = false;
      downloadBtn.addEventListener('click', () => {
        if (!compressedBlob || isCompressDownloading) return;
        isCompressDownloading = true;

        const url = URL.createObjectURL(compressedBlob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `compressed_${Date.now()}.jpg`;
        a.click();
        URL.revokeObjectURL(url);
        setTimeout(() => { isCompressDownloading = false; }, 1000);
      });

      resetBtn.addEventListener('click', () => {
        uploadArea.style.display = 'block';
        controlsContainer.style.display = 'none';
        fileInput.value = '';
        originalImage = null;
        compressedBlob = null;
        canvas.style.display = 'none';
        downloadBtn.style.display = 'none';
        qualitySlider.value = 80;
        qualityDisplay.textContent = '80%';
      });
    }
  </script>
</body>
</html>

